<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Harbour Control — Levels + Storm Handling</title>

<style>
body{
  margin:0;
  font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#0b1220;
  color:#e7eefc;
  display:flex;
  justify-content:center;
  padding:26px;
}
.app{width:min(1100px,100%);}
h1{margin:0 0 8px}
p{margin:0 0 14px;color:#a9b7d3;line-height:1.35}

.wrap{
  display:grid;
  grid-template-columns: 1fr 320px;
  gap:12px;
}

.stage{
  background:#081124;
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
}

canvas{
  width:100%;
  height:auto;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:#0e1b33;
  display:block;
  touch-action:none;
}

.panel{
  background:#081124;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  padding:12px;
  display:grid;
  gap:10px;
}

.card{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  padding:10px;
}

.row{display:flex; justify-content:space-between; gap:10px; color:#a9b7d3; font-size:13px}
.row strong{color:#e7eefc}

.msg{
  padding:10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.18);
  color:#a9b7d3;
  min-height:62px;
  line-height:1.35;
}

.controls{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

button{
  padding:10px 12px;
  border-radius:12px;
  border:none;
  font-weight:900;
  cursor:pointer;
}

.primary{background:#60a5fa;color:#081124}
.secondary{background:#1e293b;color:#e7eefc}
.danger{background:#7f1d1d;color:#e7eefc}
.ghost{background:rgba(255,255,255,.08); color:#e7eefc; border:1px solid rgba(255,255,255,.12)}

/* ---------- Mobiele touch controls ---------- */

.touchControls{
  display:none;
  margin-top:10px;
}

.touchControls .dpad{
  display:grid;
  grid-template-columns:64px 64px 64px;
  grid-template-rows:64px 64px 64px;
  gap:10px;
  justify-content:center;
}

.touchControls .dpad button{
  width:64px;
  height:64px;
  border-radius:16px;
  font-size:22px;
  font-weight:900;
  touch-action: manipulation;
}

.touchControls .up{grid-column:2;grid-row:1}
.touchControls .left{grid-column:1;grid-row:2}
.touchControls .right{grid-column:3;grid-row:2}
.touchControls .down{grid-column:2;grid-row:3}

@media (max-width: 980px){
  .wrap{grid-template-columns:1fr}
  .touchControls{display:block;}
}
</style>
</head>

<body>
<div class="app">
  <h1>Harbour Control</h1>
  <p>
    Vaar je schip veilig naar de haven. Je moet <strong>door alle boeien-poorten</strong> (in volgorde),
    <strong>ondiepte</strong> vermijden en bij <strong>storm</strong> je snelheid en stuurgedrag aanpassen.
    <br>Besturing: <strong>←/→</strong> sturen, <strong>↑/↓</strong> snelheid. <strong>Spatie</strong> = pauze.
  </p>

  <div class="wrap">
    <div class="stage">
      <canvas id="cv" width="900" height="520"></canvas>
    </div>

    <div class="panel">

      <div class="card">
        <div class="row"><span>Level</span><strong id="lvl">1 / 3</strong></div>
        <div class="row"><span>Status</span><strong id="status">Klaar</strong></div>
        <div class="row"><span>Poort</span><strong id="gate">0 / 0</strong></div>
        <div class="row"><span>Snelheid</span><strong id="spd">0.0</strong></div>
        <div class="row"><span>Koers</span><strong id="hdg">0°</strong></div>
        <div class="row"><span>Weer</span><strong id="wx">Rustig</strong></div>
        <div class="row"><span>Radar</span><strong id="rad">—</strong></div>
      </div>

      <div class="msg" id="msg">
        Druk op <strong>Start</strong>. Vaar door poort 1 → 2 → … en daarna de haven in.
      </div>

      <div class="controls">
        <button class="primary" id="startBtn">Start</button>
        <button class="secondary" id="restartBtn">Opnieuw</button>
        <button class="secondary" id="pauseBtn">Pauze</button>
        <button class="danger" id="resetBtn">Reset</button>
        <button class="ghost" id="nextBtn" style="grid-column:1 / -1; display:none;">Volgende level</button>
      </div>

      <!-- Mobiele touch bediening -->
      <div class="touchControls">
        <div class="card">
          <div class="row" style="margin-bottom:10px">
            <span>Mobiele besturing</span><strong>Touch</strong>
          </div>

          <div class="dpad">
            <button class="ghost up" data-key="up">↑</button>
            <button class="ghost left" data-key="left">←</button>
            <button class="ghost right" data-key="right">→</button>
            <button class="ghost down" data-key="down">↓</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
(() => {
  const cv = document.getElementById("cv");
  const ctx = cv.getContext("2d");

  const elLvl = document.getElementById("lvl");
  const elStatus = document.getElementById("status");
  const elGate = document.getElementById("gate");
  const elSpd = document.getElementById("spd");
  const elHdg = document.getElementById("hdg");
  const elWx = document.getElementById("wx");
  const elRad = document.getElementById("rad");
  const msg = document.getElementById("msg");

  const startBtn = document.getElementById("startBtn");
  const restartBtn = document.getElementById("restartBtn");
  const pauseBtn = document.getElementById("pauseBtn");
  const resetBtn = document.getElementById("resetBtn");
  const nextBtn = document.getElementById("nextBtn");

  const W = cv.width, H = cv.height;

  // Input
  const keys = { left:false, right:false, up:false, down:false };

  // ---------- Touch controls ----------
  function setKey(name, isDown){
    keys[name] = isDown;
  }

  document.querySelectorAll("[data-key]").forEach(btn => {
    const k = btn.dataset.key;

    const down = (e) => {
      e.preventDefault();
      setKey(k, true);
    };

    const up = (e) => {
      e.preventDefault();
      setKey(k, false);
    };

    btn.addEventListener("pointerdown", down, {passive:false});
    btn.addEventListener("pointerup", up, {passive:false});
    btn.addEventListener("pointercancel", up, {passive:false});
    btn.addEventListener("pointerleave", up, {passive:false});
  });

  window.addEventListener("blur", () => {
    keys.left = keys.right = keys.up = keys.down = false;
  });

  // ---------- Keyboard ----------
  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") { keys.left = true; e.preventDefault(); }
    if (e.key === "ArrowRight"){ keys.right = true; e.preventDefault(); }
    if (e.key === "ArrowUp")   { keys.up = true; e.preventDefault(); }
    if (e.key === "ArrowDown") { keys.down = true; e.preventDefault(); }
  });

  window.addEventListener("keyup", (e) => {
    if (e.key === "ArrowLeft") keys.left = false;
    if (e.key === "ArrowRight") keys.right = false;
    if (e.key === "ArrowUp") keys.up = false;
    if (e.key === "ArrowDown") keys.down = false;
  });

  // ---------- Mini test ship (kort voorbeeld) ----------
  const ship = { x:90, y:260, heading:0, speed:0, maxSpeed:4 };

  function update(){
    if (keys.up) ship.speed = Math.min(ship.maxSpeed, ship.speed + 0.05);
    if (keys.down) ship.speed = Math.max(0, ship.speed - 0.05);
    if (keys.left) ship.heading -= 0.04;
    if (keys.right) ship.heading += 0.04;

    ship.x += Math.cos(ship.heading) * ship.speed;
    ship.y += Math.sin(ship.heading) * ship.speed;

    draw();
    requestAnimationFrame(update);
  }

  function draw(){
    ctx.fillStyle="#0e1b33";
    ctx.fillRect(0,0,W,H);

    ctx.save();
    ctx.translate(ship.x, ship.y);
    ctx.rotate(ship.heading);
    ctx.fillStyle="#60a5fa";
    ctx.beginPath();
    ctx.moveTo(20,0);
    ctx.lineTo(-10,-10);
    ctx.lineTo(-15,0);
    ctx.lineTo(-10,10);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  update();
})();
</script>
</body>
</html>
